rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Deny all reads and writes by default for all collections.
    match /{document=**} {
      allow read, write: if false;
    }

    // Allow public, read-only access to collections needed for the website to function.
    // This includes cottages, activities, and published journal posts.
    match /cottages/{cottageId} {
      allow read: if true;
    }

    match /activities/{activityId} {
      allow read: if true;
    }

    match /posts/{postId} {
      // Only allow reading of posts that are explicitly 'published'.
      allow read: if resource.data.status == 'published';
    }

    // Allow clients to create booking documents.
    // Further validation (e.g., ensuring dates are valid) should be done in your backend/server-side logic.
    match /bookings/{bookingId} {
      allow create: if true;
      // Allow a client to read their own booking confirmation after creation.
      // This is less secure; ideally, this would be authenticated. For now, it's open.
      allow read: if true; 
    }
  }
}
