rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // cottages collection: Anyone can read this data to see available cottages.
    // Nobody can write to it directly from the client-side.
    match /cottages/{cottageId} {
      allow read: if true;
      allow write: if false;
    }

    // activities collection: Anyone can read this data.
    match /activities/{activityId} {
      allow read: if true;
      allow write: if false;
    }

    // Bookings collection: This is where we secure the data.
    match /bookings/{bookingId} {
      // A user can only read their own booking documents.
      // Your server action must add a 'guestId' field matching the authenticated user's ID.
      allow read: if request.auth.uid == resource.data.guestId;

      // Any authenticated user is allowed to create a new booking.
      allow create: if request.auth.uid != null;

      // Users are not allowed to update or delete their bookings directly.
      // This should be handled by an admin or through a secure backend process.
      allow update, delete: if false;
    }
  }
}